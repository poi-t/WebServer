# HttpServer
一个简单的HTTP服务器。使用同步I/O的方式模拟出Proactor模式，既主线程执行数据读写操作，读写完成之后，主线程向工作线程通知这一完成事件。工作线程仅对读写的结果进行逻辑处理。

采用计时器模块定时清理不活跃连接

使用redis统计访问数

暂时仅能解析GET方法

# 工作流程
## 主线程
1.服务器启动，创建epoll对象以及工作线程的线程池，并在指定端口绑定HTTP服务

2.主线程往epoll内核事件表中注册socket上的读就绪事件

3.主线程调用epoll_wait等待socket上有数据可读

4.当socket上有数据可读时，epoll_wait通知主线程。主线程从socket循环读取所有数据，然后将读取到的数据封装成一个请求对象并插入请求队列。

5.睡眠在请求队列上的某个工作线程被唤醒，它获得请求对象并处理客户请求，然后往epoll内核事件表中注册socket上的写就绪事件

6.主线程调用epoll_wait等待socket可写。

7.当socket可写时，epoll_wait通知主线程。主线程往socket上写入服务器处理客户请求的结果。

## 工作线程
1.从请求队列上取出一个请求对象并将其从队列上删去

2.对请求对象的读缓冲区数据进行解析，得到请求行，请求头，请求体

3.分析数据得到请求方法，url等内容

4.若请求方法受支持，目标文件存在且无其他错误，则构造响应报文并返回请求文件内容，其他情况返回对应的错误响应报文

5.将写就绪事件加入epoll中

## 定时器模块
1.利用定时器，定时删除保持连接但无数据读写的连接

2.定时产生SIGALRM信号并进行捕捉，捕捉到该信号时调用函数清除长时间未操作的客户端连接

# 压力测试
本项目部署在单核的云服务器上，压测也使用同一服务器，能够应对约2000左右的并发访问。

部署机器：
![image](https://user-images.githubusercontent.com/75253499/117149713-0a330380-adea-11eb-96c1-fc03a55a8b42.png)

压力测试：
![image](https://user-images.githubusercontent.com/75253499/117152981-1cfb0780-aded-11eb-93c4-b8e50e9a23ea.png)


# 测试页
http://106.13.221.214/

# 参考
1.《UNIX网络编程》

2.Tinyhttpd项目
